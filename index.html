<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mon Tracker Pro v2.8</title>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --accent: #bb86fc; --text: #ffffff; --nav: #252525; --gray: #888; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; padding-bottom: 120px; }
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: var(--nav); display: flex; justify-content: space-around; padding: 10px 5px; border-top: 1px solid #333; z-index: 100; }
        .nav-item { background: none; border: none; color: var(--gray); font-size: 0.65rem; cursor: pointer; text-transform: uppercase; padding: 10px 5px; border-radius: 8px; flex: 1; transition: 0.3s; }
        .nav-item.active { color: var(--accent); background: rgba(187, 134, 252, 0.1); font-weight: bold; }
        .header { font-size: 1.2rem; font-weight: bold; color: var(--accent); margin-bottom: 20px; }
        .view { display: none; }
        .view.active { display: block; }
        input, textarea, select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #333; background: #2c2c2c; color: white; box-sizing: border-box; margin-bottom: 10px; font-size: 1rem; }
        label { display: block; margin-top: 15px; font-size: 0.8rem; text-transform: uppercase; color: var(--gray); }
        .tag { padding: 10px 15px; background: #333; border-radius: 12px; font-size: 0.9rem; cursor: pointer; border: 1px solid transparent; }
        .tag.selected { background: var(--accent); color: black; font-weight: bold; }
        .select-area { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .db-form { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #333; }
        .db-item { background: var(--card); padding: 12px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid var(--accent); position: relative; }
        .del-btn { color: #ff5252; cursor: pointer; font-size: 0.8rem; float: right; margin-left: 10px; }
        .edit-btn { color: var(--accent); cursor: pointer; font-size: 0.8rem; float: right; }
        .save-btn { width: 100%; padding: 18px; background: var(--accent); border: none; border-radius: 12px; font-weight: bold; margin-top: 20px; color: black; font-size: 1.1rem; }
    </style>
</head>
<body>

    <div id="view-saisie" class="view active">
        <div class="header">Nouvelle Entrée</div>
        <label>Date</label>
        <input type="date" id="entry-date">
        <label>1. Où ça ?</label><div id="input-places" class="select-area"></div>
        <label>2. Quel Événement ? (Optionnel)</label><div id="input-events" class="select-area"></div>
        <label>3. Avec Qui ?</label><div id="input-people" class="select-area"></div>
        <button class="save-btn" onclick="saveEntry()">ENREGISTRER</button>
    </div>

    <div id="view-db" class="view">
        <div id="form-container" class="db-form"></div>
        <div id="db-list"></div>
    </div>

    <div id="view-resume" class="view">
        <div class="header">Historique</div>
        <div id="history-list"></div>
    </div>

    <nav class="nav-bar">
        <button class="nav-item active" onclick="showView('saisie')">Saisie</button>
        <button class="nav-item" onclick="showView('db', 'places')">Lieux</button>
        <button class="nav-item" onclick="showView('db', 'events')">Événements</button>
        <button class="nav-item" onclick="showView('db', 'people')">Personnes</button>
        <button class="nav-item" onclick="showView('resume')">Résumé</button>
    </nav>

    <script>
        let currentDBType = '';
        let editingId = null;
        let dbs = {
            places: JSON.parse(localStorage.getItem('db_places_v28') || "[]"),
            events: JSON.parse(localStorage.getItem('db_events_v28') || "[]"),
            people: JSON.parse(localStorage.getItem('db_people_v28') || "[]")
        };
        let history = JSON.parse(localStorage.getItem('tracker_history_v28') || "[]");
        let selections = { places: '', events: '', people: [] };

        function init() { document.getElementById('entry-date').valueAsDate = new Date(); renderSaisie(); }

        function showView(viewId, dbType = '') {
            editingId = null;
            document.querySelectorAll('.view, .nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + viewId).classList.add('active');
            if(dbType) { 
                currentDBType = dbType; 
                renderDBForm(); 
                renderDBList();
                document.querySelectorAll('.nav-item').forEach(n => { if(n.innerText.toLowerCase().includes(dbType)) n.classList.add('active'); });
            } else {
                document.querySelectorAll('.nav-item').forEach(n => { if(n.innerText.toLowerCase().includes(viewId)) n.classList.add('active'); });
            }
            if(viewId === 'saisie') renderSaisie();
            if(viewId === 'resume') renderStats();
        }

        function renderDBForm() {
            const container = document.getElementById('form-container');
            const title = editingId ? "Modifier l'élément" : "Nouvelle entrée";
            let html = `<strong>${title}</strong><br><br>`;
            
            if (currentDBType === 'people') {
                html += `<input type="text" id="f-nom" placeholder="Nom complet">
                         <input type="text" id="f-alias" placeholder="Alias">
                         <input type="text" id="f-addr" placeholder="Adresse">
                         <input type="tel" id="f-tel" placeholder="Téléphone">
                         <input type="text" id="f-insta" placeholder="@ Instagram">
                         <label>Anniversaire</label><input type="date" id="f-birth">`;
            } else if (currentDBType === 'places') {
                html += `<input type="text" id="f-nom" placeholder="Nom du lieu"><input type="text" id="f-addr" placeholder="Adresse">`;
            } else if (currentDBType === 'events') {
                html += `<input type="text" id="f-nom" placeholder="Nom de l'événement"><textarea id="f-desc" placeholder="Description"></textarea>`;
            }
            
            html += `<button class="save-btn" style="padding:10px;" onclick="saveToDB()">${editingId ? 'Mettre à jour' : 'Ajouter à la base'}</button>`;
            if(editingId) html += `<button class="save-btn" style="padding:10px; background:#555; margin-top:5px;" onclick="editingId=null;renderDBForm()">Annuler</button>`;
            container.innerHTML = html;

            if(editingId) {
                const item = dbs[currentDBType].find(i => i.id === editingId);
                document.getElementById('f-nom').value = item.nom || '';
                if(currentDBType === 'people') {
                    document.getElementById('f-alias').value = item.alias || '';
                    document.getElementById('f-tel').value = item.tel || '';
                    document.getElementById('f-insta').value = item.insta || '';
                    document.getElementById('f-birth').value = item.anniv || '';
                }
                if(document.getElementById('f-addr')) document.getElementById('f-addr').value = item.adresse || '';
                if(document.getElementById('f-desc')) document.getElementById('f-desc').value = item.description || '';
            }
        }

        function saveToDB() {
            const nom = document.getElementById('f-nom').value.trim();
            if(!nom) return alert("Le nom est obligatoire");
            
            let item = editingId ? dbs[currentDBType].find(i => i.id === editingId) : { id: Date.now() };
            item.nom = nom;
            item.alias = (currentDBType === 'people') ? document.getElementById('f-alias').value.trim() : nom;
            if(document.getElementById('f-addr')) item.adresse = document.getElementById('f-addr').value;
            if(document.getElementById('f-tel')) item.tel = document.getElementById('f-tel').value;
            if(document.getElementById('f-insta')) item.insta = document.getElementById('f-insta').value;
            if(document.getElementById('f-birth')) item.anniv = document.getElementById('f-birth').value;
            if(document.getElementById('f-desc')) item.description = document.getElementById('f-desc').value;

            if(!editingId) dbs[currentDBType].push(item);
            localStorage.setItem('db_'+currentDBType+'_v28', JSON.stringify(dbs[currentDBType]));
            editingId = null; renderDBForm(); renderDBList();
        }

        function renderDBList() {
            document.getElementById('db-list').innerHTML = dbs[currentDBType].map(item => `
                <div class="db-item">
                    <span class="del-btn" onclick="deleteDBItem(${item.id})">Supprimer</span>
                    <span class="edit-btn" onclick="startEditDB(${item.id})">Modifier</span>
                    <strong>${item.alias}</strong>${item.nom !== item.alias ? `<br><small>${item.nom}</small>` : ''}
                </div>
            `).join('');
        }

        function startEditDB(id) { editingId = id; renderDBForm(); window.scrollTo(0,0); }

        function deleteDBItem(id) {
            if(confirm("Supprimer ?")) {
                dbs[currentDBType] = dbs[currentDBType].filter(i => i.id !== id);
                localStorage.setItem('db_'+currentDBType+'_v28', JSON.stringify(dbs[currentDBType]));
                renderDBList();
            }
        }

        function renderSaisie() {
            ['places', 'events', 'people'].forEach(type => {
                const container = document.getElementById('input-' + type);
                container.innerHTML = dbs[type].map(item => {
                    const sel = (type === 'people') ? selections[type].includes(item.alias) : selections[type] === item.alias;
                    return `<div class="tag ${sel ? 'selected' : ''}" onclick="selectTag('${type}', '${item.alias}')">${item.alias}</div>`;
                }).join('');
            });
        }

        function selectTag(type, val) {
            if(type === 'people') {
                const idx = selections[type].indexOf(val);
                idx > -1 ? selections[type].splice(idx, 1) : selections[type].push(val);
            } else {
                selections[type] = (selections[type] === val) ? '' : val;
            }
            renderSaisie();
        }

        function saveEntry() {
            if(!selections.places) return alert("Lieu obligatoire");
            history.push({ id: Date.now(), date: document.getElementById('entry-date').value, event: selections.events || "Aucun", place: selections.places, people: [...selections.people] });
            localStorage.setItem('tracker_history_v28', JSON.stringify(history));
            alert("Enregistré !");
            selections = { places: '', events: '', people: [] }; renderSaisie();
        }

        function renderStats() {
            document.getElementById('history-list').innerHTML = history.slice().reverse().map(e => `
                <div class="history-item"><strong>${e.date}</strong> — ${e.place}<br><small>${e.event} avec ${e.people.join(', ') || 'seul'}</small></div>
            `).join('');
        }

        init();
    </script>
</body>
</html>
